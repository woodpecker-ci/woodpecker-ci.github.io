"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([[8772],{9613:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>m});var r=t(9496);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var c=r.createContext({}),l=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},p=function(e){var n=l(e.components);return r.createElement(c.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=l(t),m=o,k=u["".concat(c,".").concat(m)]||u[m]||d[m]||a;return t?r.createElement(k,s(s({ref:n},p),{},{components:t})):r.createElement(k,s({ref:n},p))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,s=new Array(a);s[0]=u;var i={};for(var c in n)hasOwnProperty.call(n,c)&&(i[c]=n[c]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var l=2;l<a;l++)s[l]=t[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},317:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>f,contentTitle:()=>m,default:()=>g,frontMatter:()=>u,metadata:()=>k,toc:()=>h});var r=t(9613),o=Object.defineProperty,a=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,p=(e,n,t)=>n in e?o(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,d=(e,n)=>{for(var t in n||(n={}))c.call(n,t)&&p(e,t,n[t]);if(i)for(var t of i(n))l.call(n,t)&&p(e,t,n[t]);return e};const u={},m="Setup",k={unversionedId:"administration/setup",id:"administration/setup",title:"Setup",description:"A Woodpecker deployment consists of two parts:",source:"@site/docs/30-administration/00-setup.md",sourceDirName:"30-administration",slug:"/administration/setup",permalink:"/docs/next/administration/setup",draft:!1,editUrl:"https://github.com/woodpecker-ci/woodpecker/edit/master/docs/docs/30-administration/00-setup.md",tags:[],version:"current",sidebarPosition:0,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Status Badges",permalink:"/docs/next/usage/badges"},next:{title:"Server configuration",permalink:"/docs/next/administration/server-config"}},f={},h=[{value:"Installation",id:"installation",level:2},{value:"docker-compose",id:"docker-compose",level:3},{value:"Authentication",id:"authentication",level:2},{value:"Database",id:"database",level:2},{value:"SSL",id:"ssl",level:2},{value:"Metrics",id:"metrics",level:2},{value:"Behind a proxy",id:"behind-a-proxy",level:2}],v={toc:h};function g(e){var n,t=e,{components:o}=t,p=((e,n)=>{var t={};for(var r in e)c.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&i)for(var r of i(e))n.indexOf(r)<0&&l.call(e,r)&&(t[r]=e[r]);return t})(t,["components"]);return(0,r.kt)("wrapper",(n=d(d({},v),p),a(n,s({components:o,mdxType:"MDXLayout"}))),(0,r.kt)("h1",d({},{id:"setup"}),"Setup"),(0,r.kt)("p",null,"A Woodpecker deployment consists of two parts:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A server which is the heart of Woodpecker and ships the web interface."),(0,r.kt)("li",{parentName:"ul"},"Next to one server you can deploy any number of agents which will run the pipelines.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Each agent is able to process one pipeline step by default."),(0,r.kt)("p",{parentName:"blockquote"},"If you have 4 agents installed and connected to the Woodpecker server, your system will process 4 builds in parallel."),(0,r.kt)("p",{parentName:"blockquote"},"You can add more agents to increase the number of parallel steps or set the agent's ",(0,r.kt)("inlineCode",{parentName:"p"},"WOODPECKER_MAX_WORKFLOWS=1")," environment variable to increase the number of parallel workflows for that agent.")),(0,r.kt)("h2",d({},{id:"installation"}),"Installation"),(0,r.kt)("p",null,"You can install Woodpecker on multiple ways:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Using ",(0,r.kt)("a",d({parentName:"li"},{href:"#docker-compose"}),"docker-compose")," with the official ",(0,r.kt)("a",d({parentName:"li"},{href:"/docs/next/downloads#docker-images"}),"container images")),(0,r.kt)("li",{parentName:"ul"},"By deploying to a ",(0,r.kt)("a",d({parentName:"li"},{href:"/docs/next/administration/kubernetes"}),"Kubernetes")," with manifests or Woodpeckers official Helm charts"),(0,r.kt)("li",{parentName:"ul"},"Using ",(0,r.kt)("a",d({parentName:"li"},{href:"/docs/next/downloads"}),"binaries"))),(0,r.kt)("h3",d({},{id:"docker-compose"}),"docker-compose"),(0,r.kt)("p",null,"The below ",(0,r.kt)("a",d({parentName:"p"},{href:"https://docs.docker.com/compose/"}),"docker-compose")," configuration can be used to start a Woodpecker server with a single agent."),(0,r.kt)("p",null,"It relies on a number of environment variables that you must set before running ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose up"),". The variables are described below."),(0,r.kt)("pre",null,(0,r.kt)("code",d({parentName:"pre"},{className:"language-yaml"}),"# docker-compose.yml\nversion: '3'\n\nservices:\n  woodpecker-server:\n    image: woodpeckerci/woodpecker-server:latest\n    ports:\n      - 8000:8000\n    volumes:\n      - woodpecker-server-data:/var/lib/woodpecker/\n    environment:\n      - WOODPECKER_OPEN=true\n      - WOODPECKER_HOST=${WOODPECKER_HOST}\n      - WOODPECKER_GITHUB=true\n      - WOODPECKER_GITHUB_CLIENT=${WOODPECKER_GITHUB_CLIENT}\n      - WOODPECKER_GITHUB_SECRET=${WOODPECKER_GITHUB_SECRET}\n      - WOODPECKER_AGENT_SECRET=${WOODPECKER_AGENT_SECRET}\n\n  woodpecker-agent:\n    image: woodpeckerci/woodpecker-agent:latest\n    command: agent\n    restart: always\n    depends_on:\n      - woodpecker-server\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    environment:\n      - WOODPECKER_SERVER=woodpecker-server:9000\n      - WOODPECKER_AGENT_SECRET=${WOODPECKER_AGENT_SECRET}\n\nvolumes:\n  woodpecker-server-data:\n")),(0,r.kt)("p",null,"Woodpecker needs to know its own address. You must therefore provide the public address of it in ",(0,r.kt)("inlineCode",{parentName:"p"},"<scheme>://<hostname>")," format. Please omit trailing slashes:"),(0,r.kt)("pre",null,(0,r.kt)("code",d({parentName:"pre"},{className:"language-diff"}),"# docker-compose.yml\nversion: '3'\n\nservices:\n  woodpecker-server:\n    [...]\n    environment:\n      - [...]\n+     - WOODPECKER_HOST=${WOODPECKER_HOST}\n+     - WOODPECKER_HOST=${WOODPECKER_HOST}\n")),(0,r.kt)("p",null,"Woodpecker can also have its port's configured. It uses a separate port for gRPC and for HTTP. The agent performs gRPC calls and connects to the gRPC port.\nThey can be configured with ADDR variables:"),(0,r.kt)("pre",null,(0,r.kt)("code",d({parentName:"pre"},{className:"language-diff"}),"# docker-compose.yml\nversion: '3'\nservices:\n  woodpecker-server:\n    [...]\n    environment:\n      - [...]\n+     - WOODPECKER_GRPC_ADDR=${WOODPECKER_GRPC_ADDR}\n+     - WOODPECKER_SERVER_ADDR=${WOODPECKER_HTTP_ADDR}\n")),(0,r.kt)("p",null,"Reverse proxying can also be ",(0,r.kt)("a",d({parentName:"p"},{href:"./proxy#caddy"}),"configured for gRPC"),". If the agents are connecting over the internet, it should also be SSL encrypted. The agent then needs to be configured to be secure:"),(0,r.kt)("pre",null,(0,r.kt)("code",d({parentName:"pre"},{className:"language-diff"}),"# docker-compose.yml\nversion: '3'\nservices:\n  woodpecker-server:\n    [...]\n    environment:\n      - [...]\n+     - WOODPECKER_GRPC_SECURE=true # defaults to false\n+     - WOODPECKER_GRPC_VERIFY=true # default\n")),(0,r.kt)("p",null,"As agents run pipeline steps as docker containers they require access to the host machine's Docker daemon:"),(0,r.kt)("pre",null,(0,r.kt)("code",d({parentName:"pre"},{className:"language-diff"}),"# docker-compose.yml\nversion: '3'\n\nservices:\n  [...]\n  woodpecker-agent:\n    [...]\n+   volumes:\n+     - /var/run/docker.sock:/var/run/docker.sock\n")),(0,r.kt)("p",null,"Agents require the server address for agent-to-server communication. The agent connects to the server's gRPC port:"),(0,r.kt)("pre",null,(0,r.kt)("code",d({parentName:"pre"},{className:"language-diff"}),"# docker-compose.yml\nversion: '3'\n\nservices:\n  woodpecker-agent:\n    [...]\n    environment:\n+     - WOODPECKER_SERVER=woodpecker-server:9000\n")),(0,r.kt)("p",null,"The server and agents use a shared secret to authenticate communication. This should be a random string of your choosing and should be kept private. You can generate such string with ",(0,r.kt)("inlineCode",{parentName:"p"},"openssl rand -hex 32"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",d({parentName:"pre"},{className:"language-diff"}),"# docker-compose.yml\nversion: '3'\n\nservices:\n  woodpecker-server:\n    [...]\n    environment:\n      - [...]\n+     - WOODPECKER_AGENT_SECRET=${WOODPECKER_AGENT_SECRET}\n  woodpecker-agent:\n    [...]\n    environment:\n      - [...]\n+     - WOODPECKER_AGENT_SECRET=${WOODPECKER_AGENT_SECRET}\n")),(0,r.kt)("h2",d({},{id:"authentication"}),"Authentication"),(0,r.kt)("p",null,"Authentication is done using OAuth and is delegated to your forge which is configured by using environment variables. The example above demonstrates basic GitHub integration."),(0,r.kt)("p",null,"See the complete reference for all supported forges ",(0,r.kt)("a",d({parentName:"p"},{href:"/docs/next/administration/forges/overview"}),"here"),"."),(0,r.kt)("h2",d({},{id:"database"}),"Database"),(0,r.kt)("p",null,"By default Woodpecker uses a SQLite database which requires zero installation or configuration. See the ",(0,r.kt)("a",d({parentName:"p"},{href:"/docs/next/administration/database"}),"database settings")," page to further configure it or use MySQL or Postgres."),(0,r.kt)("h2",d({},{id:"ssl"}),"SSL"),(0,r.kt)("p",null,"Woodpecker supports SSL configuration by using Let's encrypt or by using own certificates. See the ",(0,r.kt)("a",d({parentName:"p"},{href:"/docs/next/administration/ssl"}),"SSL guide"),"."),(0,r.kt)("h2",d({},{id:"metrics"}),"Metrics"),(0,r.kt)("p",null,"A ",(0,r.kt)("a",d({parentName:"p"},{href:"/docs/next/administration/prometheus"}),"Prometheus endpoint")," is exposed."),(0,r.kt)("h2",d({},{id:"behind-a-proxy"}),"Behind a proxy"),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",d({parentName:"p"},{href:"/docs/next/administration/proxy"}),"proxy guide")," if you want to see a setup behind Apache, Nginx, Caddy or ngrok."))}g.isMDXComponent=!0}}]);