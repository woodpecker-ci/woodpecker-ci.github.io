"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([["4755"],{94207:function(e,s,n){n.r(s),n.d(s,{default:()=>h,frontMatter:()=>a,metadata:()=>t,assets:()=>l,toc:()=>c,contentTitle:()=>o});var t=JSON.parse('{"id":"usage/secrets","title":"Secrets","description":"Woodpecker provides the ability to store named variables in a central secret store.","source":"@site/versioned_docs/version-3.7/20-usage/40-secrets.md","sourceDirName":"20-usage","slug":"/usage/secrets","permalink":"/docs/usage/secrets","draft":false,"unlisted":false,"editUrl":"https://github.com/woodpecker-ci/woodpecker/edit/main/docs/versioned_docs/version-3.7/20-usage/40-secrets.md","tags":[],"version":"3.7","sidebarPosition":40,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Matrix workflows","permalink":"/docs/usage/matrix-workflows"},"next":{"title":"Registries","permalink":"/docs/usage/registries"}}'),r=n("74132"),i=n("25337");let a={},o="Secrets",l={},c=[{value:"Usage",id:"usage",level:2},{value:"Escape secrets",id:"escape-secrets",level:3},{value:"Events filter",id:"events-filter",level:3},{value:"Plugins filter",id:"plugins-filter",level:3},{value:"CLI",id:"cli",level:2}];function d(e){let s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"secrets",children:"Secrets"})}),"\n",(0,r.jsxs)(s.p,{children:["Woodpecker provides the ability to store named variables in a central secret store.\nThese secrets can be securely passed on to individual pipeline steps using the keyword ",(0,r.jsx)(s.code,{children:"from_secret"}),"."]}),"\n",(0,r.jsx)(s.p,{children:"There are three different levels of secrets available. If a secret is defined in multiple levels, the following order of priority applies (last wins):"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Repository secrets"}),": Available for all pipelines of a repository."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Organization secrets"}),": Available for all pipelines of an organization."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Global secrets"}),": Can only be set by instance administrators.\nGlobal secrets are available for all pipelines of the ",(0,r.jsx)(s.strong,{children:"entire"})," Woodpecker instance and should therefore be used with caution."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"In addition to the native integration of secrets, external providers of secrets can also be used by interacting with them directly within pipeline steps. Access to these providers can be configured with Woodpecker secrets, which enables the retrieval of secrets from the respective external sources."}),"\n",(0,r.jsx)(s.admonition,{type:"warning",children:(0,r.jsx)(s.p,{children:"Woodpecker can mask secrets from its own secrets store, but it cannot apply the same protection to external secrets. As a result, these external secrets can be exposed in the pipeline logs."})}),"\n",(0,r.jsx)(s.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsxs)(s.p,{children:["You can set a setting or environment value from Woodpecker secrets by using the ",(0,r.jsx)(s.code,{children:"from_secret"})," syntax."]}),"\n",(0,r.jsxs)(s.p,{children:["The following example passes a secret called ",(0,r.jsx)(s.code,{children:"secret_token"})," which is stored in an environment variable called ",(0,r.jsx)(s.code,{children:"TOKEN_ENV"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:" steps:\n   - name: 'step name'\n     image: registry/repo/image:tag\n     commands:\n+      - echo \"The secret is $TOKEN_ENV\"\n+    environment:\n+      TOKEN_ENV:\n+        from_secret: secret_token\n"})}),"\n",(0,r.jsxs)(s.p,{children:["The same syntax can be used to pass secrets to (plugin) settings.\nA secret called ",(0,r.jsx)(s.code,{children:"secret_token"})," is assigned to the setting ",(0,r.jsx)(s.code,{children:"TOKEN"}),", which is then available in the plugin as the environment variable ",(0,r.jsx)(s.code,{children:"PLUGIN_TOKEN"})," (see ",(0,r.jsx)(s.a,{href:"/docs/usage/plugins/creating-plugins#settings",children:"plugins"})," for details).\n",(0,r.jsx)(s.code,{children:"PLUGIN_TOKEN"})," is then used internally by the plugin itself and taken into account during execution."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:" steps:\n   - name: 'step name'\n     image: registry/repo/image:tag\n+    settings:\n+      TOKEN:\n+        from_secret: secret_token\n"})}),"\n",(0,r.jsx)(s.h3,{id:"escape-secrets",children:"Escape secrets"}),"\n",(0,r.jsxs)(s.p,{children:["Please note that parameter expressions are preprocessed, i.e. they are evaluated before the pipeline starts.\nIf secrets are to be used in expressions, they must be properly escaped (with ",(0,r.jsx)(s.code,{children:"$$"}),") to ensure correct processing."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:" steps:\n   - name: docker\n     image: docker\n     commands:\n-      - echo ${TOKEN_ENV}\n+      - echo $${TOKEN_ENV}\n     environment:\n       TOKEN_ENV:\n         from_secret: secret_token\n"})}),"\n",(0,r.jsx)(s.h3,{id:"events-filter",children:"Events filter"}),"\n",(0,r.jsxs)(s.p,{children:["By default, secrets are not exposed to pull requests.\nHowever, you can change this behavior by creating the secret and enabling the ",(0,r.jsx)(s.code,{children:"pull_request"})," event type.\nThis can be configured either via the UI or via the CLI."]}),"\n",(0,r.jsx)(s.admonition,{type:"warning",children:(0,r.jsx)(s.p,{children:"Be careful when exposing secrets for pull requests.\nIf your repository is public and accepts pull requests from everyone, your secrets may be at risk.\nMalicious actors could take advantage of this to expose your secrets or transfer them to an external location."})}),"\n",(0,r.jsx)(s.h3,{id:"plugins-filter",children:"Plugins filter"}),"\n",(0,r.jsx)(s.p,{children:"To prevent your secrets from being misused by malicious users, you can restrict a secret to a list of plugins.\nIf enabled, they are not available to any other plugins.\nPlugins have the advantage that they cannot execute arbitrary commands and therefore cannot reveal secrets."}),"\n",(0,r.jsx)(s.admonition,{type:"tip",children:(0,r.jsx)(s.p,{children:"If you specify a tag, the filter will take it into account.\nHowever, if the same image appears several times in the list, the least privileged entry will take precedence.\nFor example, an image without a tag will allow all tags, even if it contains another entry with a tag attached."})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"plugins filter",src:n(43400).Z+"",width:"1672",height:"316"})}),"\n",(0,r.jsx)(s.h2,{id:"cli",children:"CLI"}),"\n",(0,r.jsx)(s.p,{children:"In addition to the UI, secrets can also be managed using the CLI."}),"\n",(0,r.jsxs)(s.p,{children:["Create the secret with the default settings.\nThe secret is available for all images in your pipeline and for all ",(0,r.jsx)(s.code,{children:"push"}),", ",(0,r.jsx)(s.code,{children:"tag"})," and ",(0,r.jsx)(s.code,{children:"deployment"})," events (not for ",(0,r.jsx)(s.code,{children:"pull_request"})," events)."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"woodpecker-cli repo secret add \\\n  --repository octocat/hello-world \\\n  --name aws_access_key_id \\\n  --value <value>\n"})}),"\n",(0,r.jsx)(s.p,{children:"Create the secret and limit it to a single image:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:" woodpecker-cli secret add \\\n   --repository octocat/hello-world \\\n+  --image woodpeckerci/plugin-s3 \\\n   --name aws_access_key_id \\\n   --value <value>\n"})}),"\n",(0,r.jsx)(s.p,{children:"Create the secrets and limit it to a set of images:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:" woodpecker-cli repo secret add \\\n   --repository octocat/hello-world \\\n+  --image woodpeckerci/plugin-s3 \\\n+  --image woodpeckerci/plugin-docker-buildx \\\n   --name aws_access_key_id \\\n   --value <value>\n"})}),"\n",(0,r.jsx)(s.p,{children:"Create the secret and enable it for multiple hook events:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:" woodpecker-cli repo secret add \\\n   --repository octocat/hello-world \\\n   --image woodpeckerci/plugin-s3 \\\n+  --event pull_request \\\n+  --event push \\\n+  --event tag \\\n   --name aws_access_key_id \\\n   --value <value>\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Secrets can be loaded from a file using the syntax ",(0,r.jsx)(s.code,{children:"@"}),".\nThis method is recommended for loading secrets from a file, as it ensures that line breaks are preserved (this is important for SSH keys, for example):"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:" woodpecker-cli repo secret add \\\n   -repository octocat/hello-world \\\n   -name ssh_key \\\n+  -value @/root/ssh/id_rsa\n"})})]})}function h(e={}){let{wrapper:s}={...(0,i.a)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},43400:function(e,s,n){n.d(s,{Z:function(){return t}});let t=n.p+"assets/images/secrets-plugins-filter-ed56a323353efe731df95abbff75641c.png"},25337:function(e,s,n){n.d(s,{Z:function(){return o},a:function(){return a}});var t=n(39546);let r={},i=t.createContext(r);function a(e){let s=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);