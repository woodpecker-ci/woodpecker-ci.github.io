"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([["8290"],{29883:function(e,o,n){n.r(o),n.d(o,{frontMatter:()=>s,toc:()=>c,default:()=>u,metadata:()=>r,assets:()=>a,contentTitle:()=>d});var r=JSON.parse('{"id":"administration/configuration/forges/addon","title":"Custom","description":"If the forge you are using does not meet the Woodpecker requirements or your setup is too specific to be included in the Woodpecker core, you can write an addon forge.","source":"@site/versioned_docs/version-3.7/30-administration/10-configuration/12-forges/100-addon.md","sourceDirName":"30-administration/10-configuration/12-forges","slug":"/administration/configuration/forges/addon","permalink":"/docs/3.7/administration/configuration/forges/addon","draft":false,"unlisted":false,"editUrl":"https://github.com/woodpecker-ci/woodpecker/edit/main/docs/versioned_docs/version-3.7/30-administration/10-configuration/12-forges/100-addon.md","tags":[],"version":"3.7","sidebarPosition":100,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Bitbucket Datacenter / Server","permalink":"/docs/3.7/administration/configuration/forges/bitbucket_datacenter"},"next":{"title":"Agent","permalink":"/docs/3.7/administration/configuration/agent"}}'),t=n(69979),i=n(56774);let s={},d="Custom",a={},c=[{value:"Usage",id:"usage",level:2},{value:"Bug reports",id:"bug-reports",level:3},{value:"List of addon forges",id:"list-of-addon-forges",level:2},{value:"Creating addon forges",id:"creating-addon-forges",level:2},{value:"Writing your code",id:"writing-your-code",level:3},{value:"Example structure",id:"example-structure",level:3}];function l(e){let o={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.header,{children:(0,t.jsx)(o.h1,{id:"custom",children:"Custom"})}),"\n",(0,t.jsxs)(o.p,{children:["If the forge you are using does not meet the ",(0,t.jsx)(o.a,{href:"/docs/3.7/development/core-ideas#forges",children:"Woodpecker requirements"})," or your setup is too specific to be included in the Woodpecker core, you can write an addon forge."]}),"\n",(0,t.jsx)(o.admonition,{type:"warning",children:(0,t.jsx)(o.p,{children:"Addon forges are still experimental. Their implementation can change and break at any time."})}),"\n",(0,t.jsx)(o.admonition,{type:"danger",children:(0,t.jsx)(o.p,{children:"You must trust the author of the addon forge you are using. They may have access to authentication codes and other potentially sensitive information."})}),"\n",(0,t.jsx)(o.h2,{id:"usage",children:"Usage"}),"\n",(0,t.jsx)(o.p,{children:"To use an addon forge, download the correct addon version. Then, you can add the following to your configuration:"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-ini",children:"WOODPECKER_ADDON_FORGE=/path/to/your/addon/forge/file\n"})}),"\n",(0,t.jsxs)(o.p,{children:["In case you run Woodpecker as container, you probably want to mount the addon binary to ",(0,t.jsx)(o.code,{children:"/opt/addons/"}),"."]}),"\n",(0,t.jsx)(o.h3,{id:"bug-reports",children:"Bug reports"}),"\n",(0,t.jsxs)(o.p,{children:["If you experience bugs, please check which component has the issue. If it's the addon, ",(0,t.jsx)(o.strong,{children:"do not raise an issue in the main repository"}),", but rather use the separate addon repositories. To check which component is responsible for the bug, look at the logs. Logs from addons are marked with a special field ",(0,t.jsx)(o.code,{children:"addon"})," containing their addon file name."]}),"\n",(0,t.jsx)(o.h2,{id:"list-of-addon-forges",children:"List of addon forges"}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.a,{href:"https://radicle.xyz/",children:"Radicle"}),": Open source, peer-to-peer code collaboration stack built on Git. Radicle addon for Woodpecker CI can be found at ",(0,t.jsx)(o.a,{href:"https://explorer.radicle.gr/nodes/seed.radicle.gr/rad:z39Cf1XzrvCLRZZJRUZnx9D1fj5ws",children:"this repo"}),"."]}),"\n"]}),"\n",(0,t.jsx)(o.h2,{id:"creating-addon-forges",children:"Creating addon forges"}),"\n",(0,t.jsxs)(o.p,{children:["Addons use RPC to communicate to the server and are implemented using the ",(0,t.jsxs)(o.a,{href:"https://github.com/hashicorp/go-plugin",children:[(0,t.jsx)(o.code,{children:"go-plugin"})," library"]}),"."]}),"\n",(0,t.jsx)(o.h3,{id:"writing-your-code",children:"Writing your code"}),"\n",(0,t.jsx)(o.p,{children:"This example will use the Go language."}),"\n",(0,t.jsxs)(o.p,{children:["Directly import Woodpecker's Go packages (",(0,t.jsx)(o.code,{children:"go.woodpecker-ci.org/woodpecker/v3"}),") and use the interfaces and types defined there."]}),"\n",(0,t.jsxs)(o.p,{children:["In the ",(0,t.jsx)(o.code,{children:"main"})," function, just call ",(0,t.jsx)(o.code,{children:'"go.woodpecker-ci.org/woodpecker/v3/server/forge/addon".Serve'})," with a ",(0,t.jsx)(o.code,{children:'"go.woodpecker-ci.org/woodpecker/v3/server/forge".Forge'})," as argument.\nThis will take care of connecting the addon forge to the server."]}),"\n",(0,t.jsx)(o.admonition,{type:"note",children:(0,t.jsx)(o.p,{children:"It is not possible to access global variables from Woodpecker, for example the server configuration. You must therefore parse the environment variables in your addon. The reason for this is that the addon runs in a completely separate process."})}),"\n",(0,t.jsx)(o.h3,{id:"example-structure",children:"Example structure"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-go",children:'package main\n\nimport (\n  "context"\n  "net/http"\n\n  "go.woodpecker-ci.org/woodpecker/v3/server/forge/addon"\n  forgeTypes "go.woodpecker-ci.org/woodpecker/v3/server/forge/types"\n  "go.woodpecker-ci.org/woodpecker/v3/server/model"\n)\n\nfunc main() {\n  addon.Serve(config{})\n}\n\ntype config struct {\n}\n\n// `config` must implement `"go.woodpecker-ci.org/woodpecker/v3/server/forge".Forge`. You must directly use Woodpecker\'s packages - see imports above.\n'})})]})}function u(e={}){let{wrapper:o}={...(0,i.a)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},56774:function(e,o,n){n.d(o,{Z:()=>d,a:()=>s});var r=n(52136);let t={},i=r.createContext(t);function s(e){let o=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function d(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(i.Provider,{value:o},e.children)}}}]);