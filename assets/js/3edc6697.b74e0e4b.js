"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([[4771],{9613:(e,t,o)=>{o.d(t,{Zo:()=>p,kt:()=>d});var r=o(9496);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var c=r.createContext({}),s=function(e){var t=r.useContext(c),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},p=function(e){var t=s(e.components);return r.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},k=r.forwardRef((function(e,t){var o=e.components,n=e.mdxType,i=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),k=s(o),d=n,_=k["".concat(c,".").concat(d)]||k[d]||u[d]||i;return o?r.createElement(_,a(a({ref:t},p),{},{components:o})):r.createElement(_,a({ref:t},p))}));function d(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=o.length,a=new Array(i);a[0]=k;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:n,a[1]=l;for(var s=2;s<i;s++)a[s]=o[s];return r.createElement.apply(null,a)}return r.createElement.apply(null,o)}k.displayName="MDXCreateElement"},662:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>m,contentTitle:()=>d,default:()=>O,frontMatter:()=>k,metadata:()=>_,toc:()=>S});var r=o(9613),n=Object.defineProperty,i=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,p=(e,t,o)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,u=(e,t)=>{for(var o in t||(t={}))c.call(t,o)&&p(e,o,t[o]);if(l)for(var o of l(t))s.call(t,o)&&p(e,o,t[o]);return e};const k={},d="Bitbucket Server",_={unversionedId:"administration/forges/bitbucket_server",id:"administration/forges/bitbucket_server",title:"Bitbucket Server",description:"Woodpecker comes with experimental support for Bitbucket Server, formerly known as Atlassian Stash. To enable Bitbucket Server you should configure the Woodpecker container using the following environment variables:",source:"@site/docs/30-administration/11-forges/60-bitbucket_server.md",sourceDirName:"30-administration/11-forges",slug:"/administration/forges/bitbucket_server",permalink:"/docs/next/administration/forges/bitbucket_server",draft:!1,editUrl:"https://github.com/woodpecker-ci/woodpecker/edit/master/docs/docs/30-administration/11-forges/60-bitbucket_server.md",tags:[],version:"current",sidebarPosition:60,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Bitbucket",permalink:"/docs/next/administration/forges/bitbucket"},next:{title:"Gogs",permalink:"/docs/next/administration/forges/gogs"}},m={},S=[{value:"Private Key File",id:"private-key-file",level:2},{value:"Service Account",id:"service-account",level:2},{value:"Registration",id:"registration",level:2},{value:"Configuration",id:"configuration",level:2},{value:"<code>WOODPECKER_STASH</code>",id:"woodpecker_stash",level:3},{value:"<code>WOODPECKER_STASH_URL</code>",id:"woodpecker_stash_url",level:3},{value:"<code>WOODPECKER_STASH_CONSUMER_KEY</code>",id:"woodpecker_stash_consumer_key",level:3},{value:"<code>WOODPECKER_STASH_CONSUMER_KEY_FILE</code>",id:"woodpecker_stash_consumer_key_file",level:3},{value:"<code>WOODPECKER_STASH_CONSUMER_RSA</code>",id:"woodpecker_stash_consumer_rsa",level:3},{value:"<code>WOODPECKER_STASH_CONSUMER_RSA_STRING</code>",id:"woodpecker_stash_consumer_rsa_string",level:3},{value:"<code>WOODPECKER_STASH_GIT_USERNAME</code>",id:"woodpecker_stash_git_username",level:3},{value:"<code>WOODPECKER_STASH_GIT_USERNAME_FILE</code>",id:"woodpecker_stash_git_username_file",level:3},{value:"<code>WOODPECKER_STASH_GIT_PASSWORD</code>",id:"woodpecker_stash_git_password",level:3},{value:"<code>WOODPECKER_STASH_GIT_PASSWORD_FILE</code>",id:"woodpecker_stash_git_password_file",level:3},{value:"<code>WOODPECKER_STASH_SKIP_VERIFY</code>",id:"woodpecker_stash_skip_verify",level:3}],f={toc:S};function O(e){var t,o=e,{components:n}=o,p=((e,t)=>{var o={};for(var r in e)c.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&l)for(var r of l(e))t.indexOf(r)<0&&s.call(e,r)&&(o[r]=e[r]);return o})(o,["components"]);return(0,r.kt)("wrapper",(t=u(u({},f),p),i(t,a({components:n,mdxType:"MDXLayout"}))),(0,r.kt)("h1",u({},{id:"bitbucket-server"}),"Bitbucket Server"),(0,r.kt)("p",null,"Woodpecker comes with experimental support for Bitbucket Server, formerly known as Atlassian Stash. To enable Bitbucket Server you should configure the Woodpecker container using the following environment variables:"),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-diff"}),"# docker-compose.yml\nversion: '3'\n\nservices:\n  woodpecker-server:\n    [...]\n    environment:\n      - [...]\n+     - WOODPECKER_STASH=true\n+     - WOODPECKER_STASH_GIT_USERNAME=foo\n+     - WOODPECKER_STASH_GIT_PASSWORD=bar\n+     - WOODPECKER_STASH_CONSUMER_KEY=95c0282573633eb25e82\n+     - WOODPECKER_STASH_CONSUMER_RSA=/etc/bitbucket/key.pem\n+     - WOODPECKER_STASH_URL=http://stash.mycompany.com\n    volumes:\n+     - /path/to/key.pem:/path/to/key.pem\n\n  woodpecker-agent:\n    [...]\n")),(0,r.kt)("h2",u({},{id:"private-key-file"}),"Private Key File"),(0,r.kt)("p",null,"The OAuth process in Bitbucket server requires a private and a public RSA certificate. This is how you create the private RSA certificate."),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-nohighlight"}),"openssl genrsa -out /etc/bitbucket/key.pem 1024\n")),(0,r.kt)("p",null,"This stores the private RSA certificate in ",(0,r.kt)("inlineCode",{parentName:"p"},"key.pem"),". The next command generates the public RSA certificate and stores it in ",(0,r.kt)("inlineCode",{parentName:"p"},"key.pub"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-nohighlight"}),"openssl rsa -in /etc/bitbucket/key.pem -pubout >> /etc/bitbucket/key.pub\n")),(0,r.kt)("p",null,"Please note that the private key file can be mounted into your Woodpecker container at runtime or as an environment variable"),(0,r.kt)("p",null,"Private key file mounted into your Woodpecker container at runtime as a volume."),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-diff"}),"# docker-compose.yml\nversion: '3'\n\nservices:\n  woodpecker-server:\n    [...]\n    environment:\n      - [...]\n      - WOODPECKER_STASH=true\n      - WOODPECKER_STASH_GIT_USERNAME=foo\n      - WOODPECKER_STASH_GIT_PASSWORD=bar\n      - WOODPECKER_STASH_CONSUMER_KEY=95c0282573633eb25e82\n+     - WOODPECKER_STASH_CONSUMER_RSA=/etc/bitbucket/key.pem\n      - WOODPECKER_STASH_URL=http://stash.mycompany.com\n+  volumes:\n+     - /etc/bitbucket/key.pem:/etc/bitbucket/key.pem\n\n  woodpecker-agent:\n    [...]\n")),(0,r.kt)("p",null,"Private key as environment variable"),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-diff"}),"# docker-compose.yml\nversion: '3'\n\nservices:\n  woodpecker-server:\n    [...]\n    environment:\n      - [...]\n      - WOODPECKER_STASH=true\n      - WOODPECKER_STASH_GIT_USERNAME=foo\n      - WOODPECKER_STASH_GIT_PASSWORD=bar\n      - WOODPECKER_STASH_CONSUMER_KEY=95c0282573633eb25e82\n+     - WOODPECKER_STASH_CONSUMER_RSA_STRING=contentOfPemKeyAsString\n      - WOODPECKER_STASH_URL=http://stash.mycompany.com\n\n  woodpecker-agent:\n    [...]\n")),(0,r.kt)("h2",u({},{id:"service-account"}),"Service Account"),(0,r.kt)("p",null,"Woodpecker uses ",(0,r.kt)("inlineCode",{parentName:"p"},"git+https")," to clone repositories, however, Bitbucket Server does not currently support cloning repositories with OAuth token. To work around this limitation, you must create a service account and provide the username and password to Woodpecker. This service account will be used to authenticate and clone private repositories."),(0,r.kt)("h2",u({},{id:"registration"}),"Registration"),(0,r.kt)("p",null,"You must register your application with Bitbucket Server in order to generate a consumer key. Navigate to your account settings and choose Applications from the menu, and click Register new application. Now copy & paste the text value from ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/bitbucket/key.pub")," into the ",(0,r.kt)("inlineCode",{parentName:"p"},"Public Key")," in the incoming link part of the application registration."),(0,r.kt)("p",null,"Please use ",(0,r.kt)("a",u({parentName:"p"},{href:"http://woodpecker.mycompany.com/authorize"}),"http://woodpecker.mycompany.com/authorize")," as the Authorization callback URL."),(0,r.kt)("h2",u({},{id:"configuration"}),"Configuration"),(0,r.kt)("p",null,"This is a full list of configuration options. Please note that many of these options use default configuration values that should work for the majority of installations."),(0,r.kt)("h3",u({},{id:"woodpecker_stash"}),(0,r.kt)("inlineCode",{parentName:"h3"},"WOODPECKER_STASH")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Default: ",(0,r.kt)("inlineCode",{parentName:"p"},"false"))),(0,r.kt)("p",null,"Enables the Bitbucket Server driver."),(0,r.kt)("h3",u({},{id:"woodpecker_stash_url"}),(0,r.kt)("inlineCode",{parentName:"h3"},"WOODPECKER_STASH_URL")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Default: empty")),(0,r.kt)("p",null,"Configures the Bitbucket Server address."),(0,r.kt)("h3",u({},{id:"woodpecker_stash_consumer_key"}),(0,r.kt)("inlineCode",{parentName:"h3"},"WOODPECKER_STASH_CONSUMER_KEY")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Default: empty")),(0,r.kt)("p",null,"Configures your Bitbucket Server consumer key."),(0,r.kt)("h3",u({},{id:"woodpecker_stash_consumer_key_file"}),(0,r.kt)("inlineCode",{parentName:"h3"},"WOODPECKER_STASH_CONSUMER_KEY_FILE")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Default: empty")),(0,r.kt)("p",null,"Read the value for ",(0,r.kt)("inlineCode",{parentName:"p"},"WOODPECKER_STASH_CONSUMER_KEY")," from the specified filepath"),(0,r.kt)("h3",u({},{id:"woodpecker_stash_consumer_rsa"}),(0,r.kt)("inlineCode",{parentName:"h3"},"WOODPECKER_STASH_CONSUMER_RSA")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Default: empty")),(0,r.kt)("p",null,"Configures the path to your Bitbucket Server private key file."),(0,r.kt)("h3",u({},{id:"woodpecker_stash_consumer_rsa_string"}),(0,r.kt)("inlineCode",{parentName:"h3"},"WOODPECKER_STASH_CONSUMER_RSA_STRING")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Default: empty")),(0,r.kt)("p",null,"Configures your Bitbucket Server private key."),(0,r.kt)("h3",u({},{id:"woodpecker_stash_git_username"}),(0,r.kt)("inlineCode",{parentName:"h3"},"WOODPECKER_STASH_GIT_USERNAME")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Default: empty")),(0,r.kt)("p",null,"This username is used to authenticate and clone all private repositories."),(0,r.kt)("h3",u({},{id:"woodpecker_stash_git_username_file"}),(0,r.kt)("inlineCode",{parentName:"h3"},"WOODPECKER_STASH_GIT_USERNAME_FILE")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Default: empty")),(0,r.kt)("p",null,"Read the value for ",(0,r.kt)("inlineCode",{parentName:"p"},"WOODPECKER_STASH_GIT_USERNAME")," from the specified filepath"),(0,r.kt)("h3",u({},{id:"woodpecker_stash_git_password"}),(0,r.kt)("inlineCode",{parentName:"h3"},"WOODPECKER_STASH_GIT_PASSWORD")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Default: empty")),(0,r.kt)("p",null,"The password is used to authenticate and clone all private repositories."),(0,r.kt)("h3",u({},{id:"woodpecker_stash_git_password_file"}),(0,r.kt)("inlineCode",{parentName:"h3"},"WOODPECKER_STASH_GIT_PASSWORD_FILE")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Default: empty")),(0,r.kt)("p",null,"Read the value for ",(0,r.kt)("inlineCode",{parentName:"p"},"WOODPECKER_STASH_GIT_PASSWORD")," from the specified filepath"),(0,r.kt)("h3",u({},{id:"woodpecker_stash_skip_verify"}),(0,r.kt)("inlineCode",{parentName:"h3"},"WOODPECKER_STASH_SKIP_VERIFY")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Default: ",(0,r.kt)("inlineCode",{parentName:"p"},"false"))),(0,r.kt)("p",null,"Configure if SSL verification should be skipped."))}O.isMDXComponent=!0}}]);