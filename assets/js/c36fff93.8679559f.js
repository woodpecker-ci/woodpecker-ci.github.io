/*! For license information please see c36fff93.8679559f.js.LICENSE.txt */
"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([[1774],{66985:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>p,frontMatter:()=>t,metadata:()=>d,toc:()=>a});var l=i(11527),s=i(46224);const t={},o="Multi pipelines",d={id:"usage/multi-pipeline",title:"Multi pipelines",description:"This Feature is only available for GitHub, Gitea & GitLab repositories. Follow this issue to support further development.",source:"@site/versioned_docs/version-0.15/20-usage/25-multi-pipeline.md",sourceDirName:"20-usage",slug:"/usage/multi-pipeline",permalink:"/docs/0.15/usage/multi-pipeline",draft:!1,unlisted:!1,editUrl:"https://github.com/woodpecker-ci/woodpecker/edit/main/docs/versioned_docs/version-0.15/20-usage/25-multi-pipeline.md",tags:[],version:"0.15",sidebarPosition:25,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Conditional Step Execution",permalink:"/docs/0.15/usage/conditional-execution"},next:{title:"Matrix builds",permalink:"/docs/0.15/usage/matrix-builds"}},r={},a=[{value:"Rational",id:"rational",level:2},{value:"Example multi-pipeline definition",id:"example-multi-pipeline-definition",level:2},{value:"Status lines",id:"status-lines",level:2},{value:"Flow control",id:"flow-control",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h1,{id:"multi-pipelines",children:"Multi pipelines"}),"\n",(0,l.jsx)(n.admonition,{type:"info",children:(0,l.jsxs)(n.p,{children:["This Feature is only available for GitHub, Gitea & GitLab repositories. Follow ",(0,l.jsx)(n.a,{href:"https://github.com/woodpecker-ci/woodpecker/issues/131",children:"this"})," issue to support further development."]})}),"\n",(0,l.jsxs)(n.p,{children:["By default, Woodpecker looks for the pipeline definition in ",(0,l.jsx)(n.code,{children:".woodpecker.yml"})," in the project root."]}),"\n",(0,l.jsxs)(n.p,{children:["The Multi-Pipeline feature allows the pipeline to be split into several files and placed in the ",(0,l.jsx)(n.code,{children:".woodpecker/"})," folder. Only ",(0,l.jsx)(n.code,{children:".yml"})," files will be used and files in any subfolders like ",(0,l.jsx)(n.code,{children:".woodpecker/sub-folder/test.yml"})," will be ignored. You can set some custom path like ",(0,l.jsx)(n.code,{children:".my-ci/pipelines/"})," instead of ",(0,l.jsx)(n.code,{children:".woodpecker/"})," in the ",(0,l.jsx)(n.a,{href:"/docs/0.15/usage/project-settings",children:"project settings"}),"."]}),"\n",(0,l.jsx)(n.h2,{id:"rational",children:"Rational"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"faster lint/test feedback, the pipeline doesn't have to run fully to have a lint status pushed to the remote"}),"\n",(0,l.jsx)(n.li,{children:"better organization of the pipeline along various concerns: testing, linting, feature apps"}),"\n",(0,l.jsx)(n.li,{children:"utilizing more agents to speed up build"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"example-multi-pipeline-definition",children:"Example multi-pipeline definition"}),"\n",(0,l.jsx)(n.admonition,{type:"warning",children:(0,l.jsxs)(n.p,{children:["Please note that files are only shared between steps of the same pipeline (see ",(0,l.jsx)(n.a,{href:"/docs/0.15/usage/pipeline-syntax#file-changes-are-incremental",children:"File changes are incremental"}),"). That means you cannot access artifacts e.g. from the ",(0,l.jsx)(n.code,{children:"build"})," pipeline below in the ",(0,l.jsx)(n.code,{children:"deploy"})," pipeline.\nIf you still need to pass artifacts between the pipelines you need use storage ",(0,l.jsx)(n.a,{href:"/docs/0.15/usage/plugins/plugins",children:"plugins"})," (e.g. one which stores files in an Amazon S3 bucket)."]})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:".woodpecker/\n\u251c\u2500\u2500 .build.yml\n\u251c\u2500\u2500 .deploy.yml\n\u251c\u2500\u2500 .lint.yml\n\u2514\u2500\u2500 .test.yml\n"})}),"\n",(0,l.jsx)(n.p,{children:".woodpecker/.build.yml"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"pipeline:\n  build:\n    image: debian:stable-slim\n    commands:\n      - echo building\n      - sleep 5\n"})}),"\n",(0,l.jsx)(n.p,{children:".woodpecker/.deploy.yml"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"pipeline:\n  deploy:\n    image: debian:stable-slim\n    commands:\n      - echo deploying\n\ndepends_on:\n  - lint\n  - build\n  - test\n"})}),"\n",(0,l.jsx)(n.p,{children:".woodpecker/.test.yml"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"pipeline:\n  test:\n    image: debian:stable-slim\n    commands:\n      - echo testing\n      - sleep 5\n\ndepends_on:\n  - build\n"})}),"\n",(0,l.jsx)(n.p,{children:".woodpecker/.lint.yml"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"pipeline:\n  lint:\n    image: debian:stable-slim\n    commands:\n      - echo linting\n      - sleep 5\n"})}),"\n",(0,l.jsx)(n.h2,{id:"status-lines",children:"Status lines"}),"\n",(0,l.jsx)(n.p,{children:"Each pipeline has its own status line on GitHub."}),"\n",(0,l.jsx)(n.h2,{id:"flow-control",children:"Flow control"}),"\n",(0,l.jsx)(n.p,{children:"The pipelines run in parallel on separate agents and share nothing."}),"\n",(0,l.jsxs)(n.p,{children:["Dependencies between pipelines can be set with the ",(0,l.jsx)(n.code,{children:"depends_on"})," element. A pipeline doesn't execute until its dependencies did not complete successfully."]}),"\n",(0,l.jsxs)(n.p,{children:["The name for a ",(0,l.jsx)(n.code,{children:"depends_on"})," entry is the filename without the path, leading dots and without the file extension ",(0,l.jsx)(n.code,{children:".yml"}),". If the project config for example uses ",(0,l.jsx)(n.code,{children:".woodpecker/"})," as path for ci files with a file named ",(0,l.jsx)(n.code,{children:".woodpecker/.lint.yml"})," the corresponding ",(0,l.jsx)(n.code,{children:"depends_on"})," entry would be ",(0,l.jsx)(n.code,{children:"lint"}),"."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-diff",children:"pipeline:\n  deploy:\n    image: debian:stable-slim\n    commands:\n      - echo deploying\n\n+depends_on:\n+  - lint\n+  - build\n+  - test\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Pipelines that need to run even on failures should set the ",(0,l.jsx)(n.code,{children:"runs_on"})," tag."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-diff",children:"pipeline:\n  notify:\n    image: debian:stable-slim\n    commands:\n      - echo notifying\n\ndepends_on:\n  - deploy\n\n+runs_on: [ success, failure ]\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Some pipelines don't need the source code, set the ",(0,l.jsx)(n.code,{children:"skip_clone"})," tag to skip cloning:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-diff",children:"\npipeline:\n  notify:\n    image: debian:stable-slim\n    commands:\n      - echo notifying\n\ndepends_on:\n  - deploy\n\nruns_on: [ success, failure ]\n+skip_clone: true\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},3354:(e,n,i)=>{var l=i(50959),s=Symbol.for("react.element"),t=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,d=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function a(e,n,i){var l,t={},a=null,c=null;for(l in void 0!==i&&(a=""+i),void 0!==n.key&&(a=""+n.key),void 0!==n.ref&&(c=n.ref),n)o.call(n,l)&&!r.hasOwnProperty(l)&&(t[l]=n[l]);if(e&&e.defaultProps)for(l in n=e.defaultProps)void 0===t[l]&&(t[l]=n[l]);return{$$typeof:s,type:e,key:a,ref:c,props:t,_owner:d.current}}n.Fragment=t,n.jsx=a,n.jsxs=a},11527:(e,n,i)=>{e.exports=i(3354)},46224:(e,n,i)=>{i.d(n,{Z:()=>d,a:()=>o});var l=i(50959);const s={},t=l.createContext(s);function o(e){const n=l.useContext(t);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);