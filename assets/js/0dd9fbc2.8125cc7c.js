"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([["5386"],{39694(e,n,o){o.r(n),o.d(n,{metadata:()=>r,default:()=>h,frontMatter:()=>s,contentTitle:()=>i,toc:()=>a,assets:()=>c});var r=JSON.parse('{"id":"development/addons","title":"Addons","description":"The Woodpecker server supports addons for forges and the log store.","source":"@site/versioned_docs/version-3.12/92-development/100-addons.md","sourceDirName":"92-development","slug":"/development/addons","permalink":"/docs/development/addons","draft":false,"unlisted":false,"editUrl":"https://github.com/woodpecker-ci/woodpecker/edit/main/docs/versioned_docs/version-3.12/92-development/100-addons.md","tags":[],"version":"3.12","sidebarPosition":100,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Testing","permalink":"/docs/development/testing"}}'),d=o(35656),t=o(75395);let s={},i="Addons",c={},a=[{value:"Bug reports",id:"bug-reports",level:2},{value:"Creating addons",id:"creating-addons",level:2},{value:"Writing your code",id:"writing-your-code",level:3},{value:"Example structure",id:"example-structure",level:3},{value:"Addon types",id:"addon-types",level:3}];function l(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"addons",children:"Addons"})}),"\n",(0,d.jsx)(n.p,{children:"The Woodpecker server supports addons for forges and the log store."}),"\n",(0,d.jsx)(n.admonition,{type:"warning",children:(0,d.jsx)(n.p,{children:"Addons are still experimental. Their implementation can change and break at any time."})}),"\n",(0,d.jsx)(n.h2,{id:"bug-reports",children:"Bug reports"}),"\n",(0,d.jsxs)(n.p,{children:["If you experience bugs, please check which component has the issue. If it's the addon, ",(0,d.jsx)(n.strong,{children:"do not raise an issue in the main repository"}),", but rather use the separate addon repositories. To check which component is responsible for the bug, look at the logs. Logs from addons are marked with a special field ",(0,d.jsx)(n.code,{children:"addon"})," containing their addon file name."]}),"\n",(0,d.jsx)(n.h2,{id:"creating-addons",children:"Creating addons"}),"\n",(0,d.jsxs)(n.p,{children:["Addons use RPC to communicate to the server and are implemented using the ",(0,d.jsxs)(n.a,{href:"https://github.com/hashicorp/go-plugin",children:[(0,d.jsx)(n.code,{children:"go-plugin"})," library"]}),"."]}),"\n",(0,d.jsx)(n.h3,{id:"writing-your-code",children:"Writing your code"}),"\n",(0,d.jsx)(n.p,{children:"This example will use the Go language."}),"\n",(0,d.jsxs)(n.p,{children:["Directly import Woodpecker's Go packages (",(0,d.jsx)(n.code,{children:"go.woodpecker-ci.org/woodpecker/v3"}),") and use the interfaces and types defined there."]}),"\n",(0,d.jsxs)(n.p,{children:["In the ",(0,d.jsx)(n.code,{children:"main"})," function, just call the ",(0,d.jsx)(n.code,{children:"Serve"})," method in the corresponding ",(0,d.jsx)(n.a,{href:"#addon-types",children:"addon package"})," with the service as argument.\nThis will take care of connecting the addon forge to the server."]}),"\n",(0,d.jsx)(n.admonition,{type:"note",children:(0,d.jsx)(n.p,{children:"It is not possible to access global variables from Woodpecker, for example the server configuration. You must therefore parse the environment variables in your addon. The reason for this is that the addon runs in a completely separate process."})}),"\n",(0,d.jsx)(n.h3,{id:"example-structure",children:"Example structure"}),"\n",(0,d.jsx)(n.p,{children:"This is an example for a forge addon."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n  "context"\n  "net/http"\n\n  "go.woodpecker-ci.org/woodpecker/v3/server/forge/addon"\n  forgeTypes "go.woodpecker-ci.org/woodpecker/v3/server/forge/types"\n  "go.woodpecker-ci.org/woodpecker/v3/server/model"\n)\n\nfunc main() {\n  addon.Serve(config{})\n}\n\ntype config struct {\n}\n\n// `config` must implement `"go.woodpecker-ci.org/woodpecker/v3/server/forge".Forge`. You must directly use Woodpecker\'s packages - see imports above.\n'})}),"\n",(0,d.jsx)(n.h3,{id:"addon-types",children:"Addon types"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Type"}),(0,d.jsx)(n.th,{children:"Addon package"}),(0,d.jsx)(n.th,{children:"Service interface"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Forge"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"go.woodpecker-ci.org/woodpecker/v3/server/forge/addon"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:'"go.woodpecker-ci.org/woodpecker/v3/server/forge".Forge'})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Log store"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"go.woodpecker-ci.org/woodpecker/v3/server/service/log/addon"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:'"go.woodpecker-ci.org/woodpecker/v3/server/service/log".Service'})})]})]})]})]})}function h(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(l,{...e})}):l(e)}},75395(e,n,o){o.d(n,{R:()=>s,x:()=>i});var r=o(57140);let d={},t=r.createContext(d);function s(e){let n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);