"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([["3146"],{6810(e,n,i){i.r(n),i.d(n,{metadata:()=>o,default:()=>d,frontMatter:()=>s,contentTitle:()=>a,toc:()=>c,assets:()=>l});var o=JSON.parse('{"id":"administration/configuration/forges/forgejo","title":"Forgejo","description":"Woodpecker comes with built-in support for Forgejo. To enable Forgejo you should configure the Woodpecker container using the following environment variables:","source":"@site/docs/30-administration/10-configuration/12-forges/35-forgejo.md","sourceDirName":"30-administration/10-configuration/12-forges","slug":"/administration/configuration/forges/forgejo","permalink":"/docs/next/administration/configuration/forges/forgejo","draft":false,"unlisted":false,"editUrl":"https://github.com/woodpecker-ci/woodpecker/edit/main/docs/docs/30-administration/10-configuration/12-forges/35-forgejo.md","tags":[],"version":"current","sidebarPosition":35,"frontMatter":{"toc_max_heading_level":2},"sidebar":"tutorialSidebar","previous":{"title":"Gitea","permalink":"/docs/next/administration/configuration/forges/gitea"},"next":{"title":"GitLab","permalink":"/docs/next/administration/configuration/forges/gitlab"}}'),t=i(62615),r=i(30416);let s={toc_max_heading_level:2},a="Forgejo",l={},c=[{value:"Forgejo on the same host with containers",id:"forgejo-on-the-same-host-with-containers",level:2},{value:"Registration",id:"registration",level:2},{value:"User OAuth Application",id:"user-oauth-application",level:3},{value:"System-wide OAuth Application",id:"system-wide-oauth-application",level:3},{value:"Local Connections",id:"local-connections",level:3},{value:"Configuration",id:"configuration",level:2},{value:"FORGEJO",id:"forgejo-1",level:3},{value:"FORGEJO_URL",id:"forgejo_url",level:3},{value:"FORGEJO_CLIENT",id:"forgejo_client",level:3},{value:"FORGEJO_CLIENT_FILE",id:"forgejo_client_file",level:3},{value:"FORGEJO_SECRET",id:"forgejo_secret",level:3},{value:"FORGEJO_SECRET_FILE",id:"forgejo_secret_file",level:3},{value:"FORGEJO_SKIP_VERIFY",id:"forgejo_skip_verify",level:3}];function h(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"forgejo",children:"Forgejo"})}),"\n",(0,t.jsx)(n.p,{children:"Woodpecker comes with built-in support for Forgejo. To enable Forgejo you should configure the Woodpecker container using the following environment variables:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:"WOODPECKER_FORGEJO=true\nWOODPECKER_FORGEJO_URL=YOUR_FORGEJO_URL\nWOODPECKER_FORGEJO_CLIENT=YOUR_FORGEJO_CLIENT\nWOODPECKER_FORGEJO_SECRET=YOUR_FORGEJO_CLIENT_SECRET\n"})}),"\n",(0,t.jsx)(n.h2,{id:"forgejo-on-the-same-host-with-containers",children:"Forgejo on the same host with containers"}),"\n",(0,t.jsxs)(n.p,{children:["If you have Forgejo also running on the same host within a container, make sure the agent does have access to it.\nThe agent tries to clone using the URL which Forgejo reports through its API. For simplified connectivity, you should add the Woodpecker agent to the same docker network as Forgejo is in.\nOtherwise, the communication should go via the ",(0,t.jsx)(n.code,{children:"docker0"})," gateway (usually 172.17.0.1)."]}),"\n",(0,t.jsxs)(n.p,{children:["To configure the Docker network if the network's name is ",(0,t.jsx)(n.code,{children:"forgejo"}),", configure it like this:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-diff",metastring:'title="docker-compose.yaml"',children:" services:\n   [...]\n   woodpecker-agent:\n     [...]\n     environment:\n       - [...]\n+      - WOODPECKER_BACKEND_DOCKER_NETWORK=forgejo\n"})}),"\n",(0,t.jsx)(n.h2,{id:"registration",children:"Registration"}),"\n",(0,t.jsx)(n.h3,{id:"user-oauth-application",children:"User OAuth Application"}),"\n",(0,t.jsxs)(n.p,{children:["Register your application with Forgejo to create your client id and secret. You can find the OAuth applications settings of Forgejo at ",(0,t.jsx)(n.code,{children:"https://forgejo.<host>/user/settings/"}),". It is very important that authorization callback URL matches your http(s) scheme and hostname exactly with ",(0,t.jsx)(n.code,{children:"https://<host>/authorize"})," as the path."]}),"\n",(0,t.jsx)(n.h3,{id:"system-wide-oauth-application",children:"System-wide OAuth Application"}),"\n",(0,t.jsx)(n.p,{children:"If you are the administrator of both Forgejo and Woodpecker, you may prefer to use a system-wide OAuth application instead of a user-level application. System-wide applications are managed at the Forgejo site administrator level and are visible to all users."}),"\n",(0,t.jsx)(n.p,{children:"To create a system-wide OAuth application in Forgejo:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Navigate to the site administration settings at ",(0,t.jsx)(n.code,{children:"https://forgejo.<host>/admin/settings/applications"})]}),"\n",(0,t.jsx)(n.li,{children:'Create a new OAuth2 application under the "OAuth2 Applications" section'}),"\n",(0,t.jsx)(n.li,{children:"Configure the application with the same settings as above (callback URL, etc.)"}),"\n",(0,t.jsx)(n.li,{children:"Use the generated client id and secret for Woodpecker configuration"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"System-wide applications are particularly useful for:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Shared CI/CD environments where multiple users need Woodpecker access"}),"\n",(0,t.jsx)(n.li,{children:"Organizations that want centralized control over OAuth applications"}),"\n",(0,t.jsx)(n.li,{children:"Preventing user-level application quotas from affecting CI/CD operations"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"local-connections",children:"Local Connections"}),"\n",(0,t.jsxs)(n.p,{children:["If you run the Woodpecker CI server on the same host as the Forgejo instance, you might also need to allow local connections in Forgejo. Otherwise webhooks will fail. Add the following lines to your Forgejo configuration (usually at ",(0,t.jsx)(n.code,{children:"/etc/forgejo/conf/app.ini"}),")."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:"[webhook]\nALLOWED_HOST_LIST=external,loopback\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For reference see ",(0,t.jsx)(n.a,{href:"https://forgejo.org/docs/latest/admin/config-cheat-sheet/#webhook-webhook",children:"Configuration Cheat Sheet"}),"."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"forgejo oauth setup",src:i(63943).A+"",width:"1301",height:"875"})}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["Make sure your Forgejo configuration allows requesting the API with a fixed page length of 50. The default value for the maximum page size is 50, but if you set a value lower than 50, some Woodpecker features will not work properly. Also see the ",(0,t.jsx)(n.a,{href:"https://forgejo.org/docs/latest/admin/config-cheat-sheet/#api-api",children:"Configuration Cheat Sheet"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.p,{children:"This is a full list of configuration options. Please note that many of these options use default configuration values that should work for the majority of installations."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"forgejo-1",children:"FORGEJO"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Name: ",(0,t.jsx)(n.code,{children:"WOODPECKER_FORGEJO"})]}),"\n",(0,t.jsxs)(n.li,{children:["Default: ",(0,t.jsx)(n.code,{children:"false"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Enables the Forgejo driver."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"forgejo_url",children:"FORGEJO_URL"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Name: ",(0,t.jsx)(n.code,{children:"WOODPECKER_FORGEJO_URL"})]}),"\n",(0,t.jsxs)(n.li,{children:["Default: ",(0,t.jsx)(n.code,{children:"https://next.forgejo.org"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Configures the Forgejo server address."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"forgejo_client",children:"FORGEJO_CLIENT"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Name: ",(0,t.jsx)(n.code,{children:"WOODPECKER_FORGEJO_CLIENT"})]}),"\n",(0,t.jsx)(n.li,{children:"Default: none"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Configures the Forgejo OAuth client id. This is used to authorize access."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"forgejo_client_file",children:"FORGEJO_CLIENT_FILE"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Name: ",(0,t.jsx)(n.code,{children:"WOODPECKER_FORGEJO_CLIENT_FILE"})]}),"\n",(0,t.jsx)(n.li,{children:"Default: none"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Read the value for ",(0,t.jsx)(n.code,{children:"WOODPECKER_FORGEJO_CLIENT"})," from the specified filepath"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"forgejo_secret",children:"FORGEJO_SECRET"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Name: ",(0,t.jsx)(n.code,{children:"WOODPECKER_FORGEJO_SECRET"})]}),"\n",(0,t.jsx)(n.li,{children:"Default: none"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Configures the Forgejo OAuth client secret. This is used to authorize access."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"forgejo_secret_file",children:"FORGEJO_SECRET_FILE"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Name: ",(0,t.jsx)(n.code,{children:"WOODPECKER_FORGEJO_SECRET_FILE"})]}),"\n",(0,t.jsx)(n.li,{children:"Default: none"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Read the value for ",(0,t.jsx)(n.code,{children:"WOODPECKER_FORGEJO_SECRET"})," from the specified filepath"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"forgejo_skip_verify",children:"FORGEJO_SKIP_VERIFY"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Name: ",(0,t.jsx)(n.code,{children:"WOODPECKER_FORGEJO_SKIP_VERIFY"})]}),"\n",(0,t.jsxs)(n.li,{children:["Default: ",(0,t.jsx)(n.code,{children:"false"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Configure if SSL verification should be skipped."})]})}function d(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},63943(e,n,i){i.d(n,{A:()=>o});let o=i.p+"assets/images/gitea_oauth-7f5d2bc8bfd0c02a227a328fff349af3.gif"},30416(e,n,i){i.d(n,{R:()=>s,x:()=>a});var o=i(59471);let t={},r=o.createContext(t);function s(e){let n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);