"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([["622"],{5325:function(e,n,s){s.r(n),s.d(n,{default:()=>p,frontMatter:()=>a,metadata:()=>t,assets:()=>l,toc:()=>c,contentTitle:()=>o});var t=JSON.parse('{"id":"usage/secrets","title":"Secrets","description":"Woodpecker provides the ability to store named variables in a central secret store.","source":"@site/versioned_docs/version-3.0/20-usage/40-secrets.md","sourceDirName":"20-usage","slug":"/usage/secrets","permalink":"/docs/usage/secrets","draft":false,"unlisted":false,"editUrl":"https://github.com/woodpecker-ci/woodpecker/edit/main/docs/versioned_docs/version-3.0/20-usage/40-secrets.md","tags":[],"version":"3.0","sidebarPosition":40,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Matrix workflows","permalink":"/docs/usage/matrix-workflows"},"next":{"title":"Registries","permalink":"/docs/usage/registries"}}'),r=s("96773"),i=s("16070");let a={},o="Secrets",l={},c=[{value:"Usage",id:"usage",level:2},{value:"Note about parameter pre-processing",id:"note-about-parameter-pre-processing",level:3},{value:"Use in Pull Requests events",id:"use-in-pull-requests-events",level:3},{value:"Plugins filter",id:"plugins-filter",level:2},{value:"Adding Secrets",id:"adding-secrets",level:2},{value:"CLI Examples",id:"cli-examples",level:3}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"secrets",children:"Secrets"})}),"\n",(0,r.jsxs)(n.p,{children:["Woodpecker provides the ability to store named variables in a central secret store.\nThese secrets can be passed securely to individual pipeline steps using the ",(0,r.jsx)(n.code,{children:"from_secret"})," keyword."]}),"\n",(0,r.jsx)(n.p,{children:"Three different levels of secrets are available.\nThe following list shows the priority of these.\nIf a secret is defined in multiple levels, the following precedence applies: Repository secrets > Organization secrets > Global secrets."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Repository secrets"}),": Available to all pipelines of a repository."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Organization secrets"}),": Available to all pipelines of an organization."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Global secrets"}),": Can only be set by instance admins.\nGlobal secret are available to all pipelines of the ",(0,r.jsx)(n.strong,{children:"entire"})," Woodpecker instance and should therefore be used with caution."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"In addition to the native secret integration, external secret providers can be utilized by interacting with them directly within pipeline steps.\nAccess to these providers can be configured using Woodpecker secrets, enabling the retrieval of secrets from the respective external sources."})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"Woodpecker can mask secrets from its native secret store, but it cannot apply the same protection to external secrets. As a result, these external secrets may be exposed in the pipeline logs."})}),"\n",(0,r.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsxs)(n.p,{children:["You can set a setting or environment value from Woodpecker secrets using the ",(0,r.jsx)(n.code,{children:"from_secret"})," syntax."]}),"\n",(0,r.jsxs)(n.p,{children:["The example below passes a secret called ",(0,r.jsx)(n.code,{children:"secret_token"})," which will be stored in an environment variable named ",(0,r.jsx)(n.code,{children:"TOKEN_ENV"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:" steps:\n   - name: 'step name'\n     image: registry/repo/image:tag\n     commands:\n+      - echo \"The secret is $TOKEN_ENV\"\n+    environment:\n+      TOKEN_ENV:\n+        from_secret: secret_token\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The same syntax can be used to pass secrets to (plugin) settings.\nA secret named ",(0,r.jsx)(n.code,{children:"secret_token"})," is assigned to the setting ",(0,r.jsx)(n.code,{children:"TOKEN"}),", which will then be available in the plugin as environment variable ",(0,r.jsx)(n.code,{children:"PLUGIN_TOKEN"})," (see ",(0,r.jsx)(n.a,{href:"/docs/usage/plugins/creating-plugins#settings",children:"plugins"})," for details).\n",(0,r.jsx)(n.code,{children:"PLUGIN_TOKEN"})," is then internally consumed by the plugin itself and will be honored during execution."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:" steps:\n   - name: 'step name'\n     image: registry/repo/image:tag\n+    settings:\n+      TOKEN:\n+        from_secret: secret_token\n"})}),"\n",(0,r.jsx)(n.h3,{id:"note-about-parameter-pre-processing",children:"Note about parameter pre-processing"}),"\n",(0,r.jsxs)(n.p,{children:["Please note that parameter expressions undergo pre-processing, meaning they are evaluated before the pipeline starts.\nIf secrets are to be used in expressions, they must be properly escaped (using ",(0,r.jsx)(n.code,{children:"$$"}),") to ensure correct handling."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:" steps:\n   - name: docker\n     image: docker\n     commands:\n-      - echo ${TOKEN_ENV}\n+      - echo $${TOKEN_ENV}\n     environment:\n       TOKEN_ENV:\n         from_secret: secret_token\n"})}),"\n",(0,r.jsx)(n.h3,{id:"use-in-pull-requests-events",children:"Use in Pull Requests events"}),"\n",(0,r.jsxs)(n.p,{children:["By default, secrets are not exposed to pull requests.\nHowever, you can change this behavior by creating the secret and enabling the ",(0,r.jsx)(n.code,{children:"pull_request"})," event type.\nThis can be configured either through the UI or via the CLI, as demonstrated below."]}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"Be cautious when exposing secrets to pull requests.\nIf your repository is public and initiates pull request runs without requiring approval, your secrets may be at risk.\nMalicious actors could potentially exploit this to expose or transmit your secrets to an external location."})}),"\n",(0,r.jsx)(n.h2,{id:"plugins-filter",children:"Plugins filter"}),"\n",(0,r.jsx)(n.p,{children:"To prevent abusing your secrets from malicious usage, you can limit a secret to a list of plugins.\nIf enabled they are not available to any other plugin (steps without user-defined commands).\nPlugins have the advantage that they cannot run arbitrary commands, hence they cannot be used to expose secrets (in contrast to arbitrary steps)."}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"If you specify a tag, the filter will honor it.\nHowever, if the same image appears multiple times in the list, the least privileged entry takes precedence.\nFor example, an image without a tag will permit all tags, even if another entry with a pinned tag is included."})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"plugins filter",src:s(72927).Z+"",width:"1672",height:"316"})}),"\n",(0,r.jsx)(n.h2,{id:"adding-secrets",children:"Adding Secrets"}),"\n",(0,r.jsx)(n.p,{children:"Secrets can be added through the UI or via the CLI."}),"\n",(0,r.jsx)(n.h3,{id:"cli-examples",children:"CLI Examples"}),"\n",(0,r.jsxs)(n.p,{children:["Create the secret using default settings.\nThe secret will be available to all images in your pipeline, and will be available to all ",(0,r.jsx)(n.code,{children:"push"}),", ",(0,r.jsx)(n.code,{children:"tag"}),", and ",(0,r.jsx)(n.code,{children:"deployment"})," events (not ",(0,r.jsx)(n.code,{children:"pull_request"})," events)."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"woodpecker-cli repo secret add \\\n  --repository octocat/hello-world \\\n  --name aws_access_key_id \\\n  --value <value>\n"})}),"\n",(0,r.jsx)(n.p,{children:"Create the secret and limit it to a single image:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:" woodpecker-cli secret add \\\n   --repository octocat/hello-world \\\n+  --image woodpeckerci/plugin-s3 \\\n   --name aws_access_key_id \\\n   --value <value>\n"})}),"\n",(0,r.jsx)(n.p,{children:"Create the secrets and limit it to a set of images:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:" woodpecker-cli repo secret add \\\n   --repository octocat/hello-world \\\n+  --image woodpeckerci/plugin-s3 \\\n+  --image woodpeckerci/plugin-docker-buildx \\\n   --name aws_access_key_id \\\n   --value <value>\n"})}),"\n",(0,r.jsx)(n.p,{children:"Create the secret and enable it for multiple hook events:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:" woodpecker-cli repo secret add \\\n   --repository octocat/hello-world \\\n   --image woodpeckerci/plugin-s3 \\\n+  --event pull_request \\\n+  --event push \\\n+  --event tag \\\n   --name aws_access_key_id \\\n   --value <value>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Secrets can be loaded from a file using the ",(0,r.jsx)(n.code,{children:"@"})," syntax.\nThis method is recommended for loading secrets from a file, as it ensures that newlines are preserved (this is for example important for SSH keys).\nHere\u2019s an example:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:" woodpecker-cli repo secret add \\\n   -repository octocat/hello-world \\\n   -name ssh_key \\\n+  -value @/root/ssh/id_rsa\n"})})]})}function p(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},72927:function(e,n,s){s.d(n,{Z:function(){return t}});let t=s.p+"assets/images/secrets-plugins-filter-ed56a323353efe731df95abbff75641c.png"},16070:function(e,n,s){s.d(n,{Z:function(){return o},a:function(){return a}});var t=s(41699);let r={},i=t.createContext(r);function a(e){let n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);